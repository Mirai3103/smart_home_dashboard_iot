{% extends "base.html" %} {% block title %}Smart Home Dashboard{% endblock %} {%
block custom_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/dashboard.css') }}"
/>
{% endblock %} {% block content %}
<div class="dashboard-header">
  <div class="row align-items-center">
    <div class="col-md-6">
      <h1><i class="fas fa-tachometer-alt me-2"></i>Smart Home Dashboard</h1>
      <p class="text-muted">
        Real-time monitoring and control for your connected home
      </p>
    </div>
    <div class="col-md-6 text-md-end">
      <div class="btn-group" role="group">
        <button
          type="button"
          class="btn btn-outline-primary room-filter"
          data-room="all"
        >
          <i class="fas fa-home me-1"></i> All Rooms
        </button>
        <button
          type="button"
          class="btn btn-outline-primary room-filter"
          data-room="living_room"
        >
          <i class="fas fa-couch me-1"></i> Living Room
        </button>
        <button
          type="button"
          class="btn btn-outline-primary room-filter"
          data-room="bedroom"
        >
          <i class="fas fa-bed me-1"></i> Bedroom
        </button>
        <button
          type="button"
          class="btn btn-outline-primary room-filter"
          data-room="kitchen"
        >
          <i class="fas fa-utensils me-1"></i> Kitchen
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Dashboard Stats Summary -->
<div class="row dashboard-stats">
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon text-primary">
        <i class="fas fa-microchip"></i>
      </div>
      <div class="stat-card-title">Connected Devices</div>
      <div class="stat-card-value">{{ devices|length }}</div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon text-success">
        <i class="fas fa-wifi"></i>
      </div>
      <div class="stat-card-title">Online Devices</div>
      <div class="stat-card-value">
        {{ devices|selectattr('status', 'equalto', 'online')|list|length }}
      </div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon text-warning">
        <i class="fas fa-thermometer-half"></i>
      </div>
      <div class="stat-card-title">Average Temperature</div>
      <div class="stat-card-value" id="avg-temperature">--°C</div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="stat-card-icon text-info">
        <i class="fas fa-tint"></i>
      </div>
      <div class="stat-card-title">Average Humidity</div>
      <div class="stat-card-value" id="avg-humidity">--%</div>
    </div>
  </div>
</div>

<!-- Overview Chart -->
<div class="card mb-4">
  <div class="card-header">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="fas fa-chart-line me-2"></i>24 Hour Overview
      </h5>
      <div class="btn-group btn-group-sm" role="group">
        <button type="button" class="btn btn-outline-primary active">
          Temperature
        </button>
        <button type="button" class="btn btn-outline-primary">Humidity</button>
        <button type="button" class="btn btn-outline-primary">All Data</button>
      </div>
    </div>
  </div>
  <div class="card-body">
    <div class="timeline-chart-container" id="overview-chart">
      <canvas></canvas>
    </div>
  </div>
</div>

<!-- Rooms Grid -->
<h2 class="mt-4 mb-3"><i class="fas fa-th-large me-2"></i>Rooms</h2>

<!-- Living Room -->
<div class="card mb-4">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0"><i class="fas fa-couch me-2"></i>Living Room</h5>
  </div>
  <div class="card-body">
    <div class="row">
      {% for device in devices %} {% if device.location == 'living_room' %}
      <div class="col-md-4 col-sm-6 mb-4 device-card-container">
        <div
          class="card device-card h-100"
          data-room="{{ device.location }}"
          data-device-type="{{ device.type }}"
        >
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-0">
                <span
                  class="device-status status-{{ device.status }}"
                  data-device-id="{{ device.device_id }}"
                ></span>
                {{ device.name }}
              </h6>
              <span class="badge bg-primary rounded-pill"
                >{{ device.location|replace('_', ' ')|title }}</span
              >
            </div>
          </div>
          <div class="card-body d-flex flex-column">
            {% if device.type == 'temperature' %}
            <div class="text-center mb-3">
              <i
                class="fas fa-thermometer-half device-icon temperature-icon temp-indicator"
                data-device-id="{{ device.device_id }}"
              ></i>
            </div>
            <div class="text-center">
              <div
                class="value-display"
                data-device-id="{{ device.device_id }}"
              >
                --
              </div>
              <div class="value-unit">°C</div>
            </div>
            {% elif device.type == 'humidity' %}
            <div class="text-center mb-3">
              <i
                class="fas fa-tint device-icon humidity-indicator"
                data-device-id="{{ device.device_id }}"
              ></i>
            </div>
            <div class="text-center">
              <div
                class="value-display"
                data-device-id="{{ device.device_id }}"
              >
                --
              </div>
              <div class="value-unit">%</div>
            </div>
            {% elif device.type == 'light' %}
            <div class="text-center mb-3">
              <i
                class="fas fa-lightbulb device-icon light-bulb"
                data-device-id="{{ device.device_id }}"
              ></i>
            </div>
            <div class="device-detail-controls">
              <label class="device-toggle">
                <input
                  type="checkbox"
                  data-device-id="{{ device.device_id }}"
                />
                <span class="device-toggle-slider"></span>
              </label>
              <div class="mt-3">
                <label for="brightness-{{ device.id }}" class="form-label"
                  >Brightness</label
                >
                <input
                  type="range"
                  class="form-range range-control"
                  id="brightness-{{ device.id }}"
                  min="0"
                  max="100"
                  step="1"
                  value="50"
                  data-device-id="{{ device.device_id }}"
                  data-action="set_brightness"
                  data-value-display="brightness-value-{{ device.id }}"
                />
                <div class="d-flex justify-content-between">
                  <span>0%</span>
                  <span id="brightness-value-{{ device.id }}">50</span>
                  <span>100%</span>
                </div>
              </div>
            </div>
            {% endif %}

            <div class="mt-auto">
              <p class="last-updated mb-0 mt-3">
                <small
                  >Last update:
                  <span
                    class="last-updated-time"
                    data-device-id="{{ device.device_id }}"
                    data-timestamp="{{ device.last_seen }}"
                  >
                    {{ device.last_seen|default('never', true) }}
                  </span></small
                >
              </p>
            </div>
          </div>
          <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
              <small
                class="text-muted device-status-text"
                data-device-id="{{ device.device_id }}"
                >{{ device.status }}</small
              >
              <button
                class="btn btn-sm btn-outline-primary refresh-button"
                data-refresh-target="device-{{ device.id }}"
                data-refresh-url="/api/devices/{{ device.device_id }}/data?limit=1"
              >
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      {% endif %} {% endfor %}
    </div>
  </div>
</div>

<!-- Bedroom -->
<div class="card mb-4">
  <div class="card-header bg-info text-white">
    <h5 class="mb-0"><i class="fas fa-bed me-2"></i>Bedroom</h5>
  </div>
  <div class="card-body">
    <div class="row">
      {% for device in devices %} {% if device.location == 'bedroom' %}
      <div class="col-md-4 col-sm-6 mb-4 device-card-container">
        <div
          class="card device-card h-100"
          data-room="{{ device.location }}"
          data-device-type="{{ device.type }}"
        >
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-0">
                <span
                  class="device-status status-{{ device.status }}"
                  data-device-id="{{ device.device_id }}"
                ></span>
                {{ device.name }}
              </h6>
              <span class="badge bg-info rounded-pill"
                >{{ device.location|replace('_', ' ')|title }}</span
              >
            </div>
          </div>
          <div class="card-body d-flex flex-column">
            {% if device.type == 'temperature' %}
            <div class="text-center mb-3">
              <i
                class="fas fa-thermometer-half device-icon temperature-icon temp-indicator"
                data-device-id="{{ device.device_id }}"
              ></i>
            </div>
            <div class="text-center">
              <div
                class="value-display"
                data-device-id="{{ device.device_id }}"
              >
                --
              </div>
              <div class="value-unit">°C</div>
            </div>
            {% elif device.type == 'humidity' %}
            <div class="text-center mb-3">
              <i
                class="fas fa-tint device-icon humidity-indicator"
                data-device-id="{{ device.device_id }}"
              ></i>
            </div>
            <div class="text-center">
              <div
                class="value-display"
                data-device-id="{{ device.device_id }}"
              >
                --
              </div>
              <div class="value-unit">%</div>
            </div>
            {% elif device.type == 'light' %}
            <div class="text-center mb-3">
              <i
                class="fas fa-lightbulb device-icon light-bulb"
                data-device-id="{{ device.device_id }}"
              ></i>
            </div>
            <div class="device-detail-controls">
              <label class="device-toggle">
                <input
                  type="checkbox"
                  data-device-id="{{ device.device_id }}"
                />
                <span class="device-toggle-slider"></span>
              </label>
              <div class="mt-3">
                <label for="brightness-{{ device.id }}" class="form-label"
                  >Brightness</label
                >
                <input
                  type="range"
                  class="form-range range-control"
                  id="brightness-{{ device.id }}"
                  min="0"
                  max="100"
                  step="1"
                  value="50"
                  data-device-id="{{ device.device_id }}"
                  data-action="set_brightness"
                  data-value-display="brightness-value-{{ device.id }}"
                />
                <div class="d-flex justify-content-between">
                  <span>0%</span>
                  <span id="brightness-value-{{ device.id }}">50</span>
                  <span>100%</span>
                </div>
              </div>
            </div>
            {% endif %}

            <div class="mt-auto">
              <p class="last-updated mb-0 mt-3">
                <small
                  >Last update:
                  <span
                    class="last-updated-time"
                    data-device-id="{{ device.device_id }}"
                    data-timestamp="{{ device.last_seen }}"
                  >
                    {{ device.last_seen|default('never', true) }}
                  </span></small
                >
              </p>
            </div>
          </div>
          <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
              <small
                class="text-muted device-status-text"
                data-device-id="{{ device.device_id }}"
                >{{ device.status }}</small
              >
              <button
                class="btn btn-sm btn-outline-primary refresh-button"
                data-refresh-target="device-{{ device.id }}"
                data-refresh-url="/api/devices/{{ device.device_id }}/data?limit=1"
              >
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      {% endif %} {% endfor %}
    </div>
  </div>
</div>

<!-- Data Charts -->
<h2 class="mt-4 mb-3">
  <i class="fas fa-chart-area me-2"></i>Sensor Data Charts
</h2>

<div class="row">
  <!-- Temperature Chart -->
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="fas fa-thermometer-half me-2"></i>Temperature
          </h5>
          <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-outline-primary active">
              1h
            </button>
            <button type="button" class="btn btn-outline-primary">6h</button>
            <button type="button" class="btn btn-outline-primary">24h</button>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div
          class="chart-container"
          data-device-id="temp_living_room"
          data-chart-type="line"
          data-device-type="temperature"
          data-chart-url="/api/devices/temp_living_room/data?days=1&limit=100"
        >
          <div class="chart-loading d-none">
            <div class="d-flex justify-content-center align-items-center h-100">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
          <canvas></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Humidity Chart -->
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="fas fa-tint me-2"></i>Humidity</h5>
          <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-outline-primary active">
              1h
            </button>
            <button type="button" class="btn btn-outline-primary">6h</button>
            <button type="button" class="btn btn-outline-primary">24h</button>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div
          class="chart-container"
          data-device-id="humidity_living_room"
          data-chart-type="line"
          data-device-type="humidity"
          data-chart-url="/api/devices/humidity_living_room/data?days=1&limit=100"
        >
          <div class="chart-loading d-none">
            <div class="d-flex justify-content-center align-items-center h-100">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
          <canvas></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block custom_js %}
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
